## 流程

```shell
nix shell nixpkgs#k3sup

# 主节点
k3sup install --user shelken --ip 192.168.6.110 \
  --k3s-extra-args "--disable traefik --disable servicelb --flannel-backend=none --disable-network-policy" --ssh-key ~/.ssh/id_ed25519

# Install K3s joining a cluster as an agent
k3sup join \
    --user shelken \
    --ip 192.168.6.111 \
    --server-ip 192.168.6.110 \
    --server-user shelken \
    --ssh-key ~/.ssh/id_ed25519

```

## 卸载说明

如果需要卸载 k3s，需要在每个节点上执行以下操作：

1. 在工作节点（agent）上执行：

```shell
# 对于 agent 节点
/usr/local/bin/k3s-agent-uninstall.sh
# ansible 
ansible workers -m shell -a "sudo /usr/local/bin/k3s-agent-uninstall.sh"
ansible-playbook playbooks/delete-k3s.yml
```

1. 在主节点（server）上执行：

```shell
# 对于 server 节点
/usr/local/bin/k3s-uninstall.sh
ansible control_plane -m shell -a "sudo /usr/local/bin/k3s-uninstall.sh"
ansible-playbook playbooks/delete-k3s.yml
```

注意：

- 卸载脚本会停止所有 k3s 进程
- 删除 k3s 相关的文件和目录
- 删除 iptables 规则和 ipvs 表
- 移除 k3s 创建的网络接口
