router id 192.168.6.1;
log syslog { info, warning, error };

define LOCAL_ASN = 64513;
define K8S_ASN = 64514;
define HOME_ASN = 64515;
define HOME_ROUTER_IP = 192.168.191.10;

define SAKAMOTO_IP = 192.168.6.80;
define HOMELAB1_IP = 192.168.6.110;
define TVBOX_IP = 192.168.6.141;

protocol device {
    scan time 10;
}

protocol direct {
    ipv4;
    interface "br-lan", "br-lan.*";
}

protocol kernel {
    ipv4 {
        import all;
        export all;
    };
    persist;
    learn;
}

#filter accept_k8s_routes {
#    if net.len = 32 then accept;
#    if net ~ [ 10.42.0.0/16{24,32} ] then accept;
#    reject;
#}

#filter export_local_routes {
#    if net = 192.168.6.0/24 then accept;
#    if net ~ [ 10.42.0.0/16{24,32} ] then accept;
#    if net.len = 32 then accept;
#    reject;
#}

template bgp k8s {
    local as LOCAL_ASN;
    hold time 90;
    keepalive time 30;

    ipv4 {
        import all;
        export all;
        next hop self;
    };
}

protocol bgp sakamoto_k8s from k8s {
    neighbor SAKAMOTO_IP as K8S_ASN;
}
protocol bgp homelab_1 from k8s {
    neighbor HOMELAB1_IP as K8S_ASN;
}
protocol bgp tvbox from k8s {
    neighbor TVBOX_IP as K8S_ASN;
}

protocol bgp router_home {
    local as LOCAL_ASN;
    neighbor HOME_ROUTER_IP as HOME_ASN;

    ipv4 {
        import all;
        export all;
        next hop self;
    };
}
