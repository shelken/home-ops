---
- name: 传递资源
  hosts: all
  become:
    true
    # vars:
    #   k3s_proxy_ip: "192.168.6.248"
    #   k3s_proxy_port: "7890"
    #   delete_proxy: false
  tasks:
    - name: Check if /etc/rancher/k3s directory exists
      ansible.builtin.stat:
        path: /etc/rancher/k3s
      register: k3s_dir
    - name: 复制本地文件到远程并强制覆盖
      ansible.builtin.copy:
        src: "{{ playbook_dir }}/resource/registries.yaml"
        dest: /etc/rancher/k3s/registries.yaml
        owner: root
        group: root
        mode: "0600"
        force: true
      when: k3s_dir.stat.exists
    - name: 重启k3s
      ansible.builtin.service:
        name: "k3s"
        state: restarted
      when: k3s_dir.stat.exists
