---
- name: 创建 k3s 配置目录
  ansible.builtin.file:
    path: /etc/rancher/k3s
    state: directory
    owner: root
    group: root
    mode: '0755'

- name: 设置 registries 文件名
  ansible.builtin.set_fact:
    registries_file: "{{ 'registries-remote.yaml' if (remote_node | default(false)) else 'registries.yaml' }}"

- name: 复制 registries 配置到远程节点
  ansible.builtin.copy:
    src: "{{ playbook_dir }}/resource/{{ registries_file }}"
    dest: /etc/rancher/k3s/registries.yaml
    owner: root
    group: root
    mode: "0600"
    force: true
  notify: restart k3s
