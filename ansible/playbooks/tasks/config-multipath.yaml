---
- name: 检查 multipathd 服务是否存在
  ansible.builtin.command: systemctl status multipathd.service
  register: check_multipathd
  failed_when: false
  changed_when: false

- name: 复制本地文件到远程并强制覆盖
  ansible.builtin.copy:
    src: "{{ playbook_dir }}/resource/{{ item }}"
    dest: /etc/{{ item }}
    owner: root
    group: root
    mode: "0644"
    force: true
  loop:
    - multipath.conf
  when: check_multipathd.rc == 0

- name: 重启 multipathd
  ansible.builtin.service:
    name: "{{ item }}"
    state: restarted
  loop: 
    - "multipathd"
  failed_when: false
  ignore_errors: true
  when: check_multipathd.rc == 0