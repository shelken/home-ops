---
- name: 检查是否需要安装 Docker
  ansible.builtin.set_fact:
    should_install_docker: "{{ enable_install_docker | default(false) | bool }}"

- name: 检查 Docker 是否已安装
  ansible.builtin.command: docker --version
  register: docker_check
  failed_when: false
  changed_when: false
  when: should_install_docker

- name: 安装 Docker (使用官方脚本)
  ansible.builtin.shell: |
    curl -fsSL https://get.docker.com -o get-docker.sh
    sh get-docker.sh
    rm get-docker.sh
  args:
    creates: /usr/bin/docker
  when:
    - should_install_docker
    - docker_check.rc != 0
