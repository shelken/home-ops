apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: longhorn-system
resources: []
patches:
  - target:
      kind: Deployment
      name: csi-attacher
    patch: |
      - op: replace
        path: /spec/template/spec/affinity
        value:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchLabels:
                    app: csi-attacher
                topologyKey: kubernetes.io/hostname
  - target:
      kind: Deployment
      name: csi-provisioner
    patch: |
      - op: replace
        path: /spec/template/spec/affinity
        value:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchLabels:
                    app: csi-provisioner
                topologyKey: kubernetes.io/hostname
  - target:
      kind: Deployment
      name: csi-resizer
    patch: |
      - op: replace
        path: /spec/template/spec/affinity
        value:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchLabels:
                    app: csi-resizer
                topologyKey: kubernetes.io/hostname
  - target:
      kind: Deployment
      name: csi-snapshotter
    patch: |
      - op: replace
        path: /spec/template/spec/affinity
        value:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchLabels:
                    app: csi-snapshotter
                topologyKey: kubernetes.io/hostname
