# ref: https://external-secrets.io/latest/api/externalsecret/
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &secret kite-secret
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: azure-store
  target:
    name: *secret
    template:
      data:
        KITE_USERNAME: "{{.KITE_USERNAME}}"
        KITE_PASSWORD: "{{.KITE_PASSWORD}}"
        ## oauth
        OAUTH_ALLOW_USERS: shelken
        OAUTH_PROVIDERS: authelia
        AUTHELIA_CLIENT_ID: kite
        AUTHELIA_CLIENT_SECRET: "{{ .AUTHELIA_CLIENT_SECRET }}"
        AUTHELIA_REDIRECT_URL: https://kite.${MAIN_DOMAIN}/api/auth/callback
        AUTHELIA_SCOPES: openid,profile
        AUTHELIA_AUTH_URL: https://auth.${MAIN_DOMAIN}/api/oidc/authorization
        AUTHELIA_TOKEN_URL: https://auth.${MAIN_DOMAIN}/api/oidc/token
        AUTHELIA_USERINFO_URL: https://auth.${MAIN_DOMAIN}/api/oidc/userinfo
  dataFrom:
    - extract:
        key: kite-secret